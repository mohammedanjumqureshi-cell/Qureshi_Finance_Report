<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Qureshi Finance Report</title>

<link rel="manifest" href="manifest-blue.json" />
<meta name="theme-color" content="#2b6cb0" />
<link rel="icon" href="favicon.ico" />
<link rel="stylesheet" href="style.css" />
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<!-- ✅ SheetJS (Excel export library) -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

<style>
  body {
    font-family: 'Segoe UI', sans-serif;
    background: #f4f7fa;
    color: #333;
    margin: 0;
    padding: 0;
  }
  header {
    background: #2b6cb0;
    color: white;
    text-align: center;
    padding: 1rem;
  }
  main {
    max-width: 800px;
    margin: 2rem auto;
    background: white;
    border-radius: 8px;
    box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    padding: 2rem;
  }
  form {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
    margin-bottom: 1rem;
  }
  input, select, button {
    padding: 0.6rem;
    border: 1px solid #ccc;
    border-radius: 4px;
    font-size: 1rem;
  }
  button {
    background: #2b6cb0;
    color: white;
    cursor: pointer;
  }
  button:hover { background: #1e4e8c; }
  table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 1rem;
  }
  th, td {
    border-bottom: 1px solid #ddd;
    padding: 0.5rem;
  }
  .summary {
    display: flex;
    justify-content: space-between;
    text-align: center;
    margin-top: 2rem;
  }
  .summary div {
    flex: 1;
    margin: 0 0.5rem;
    padding: 1rem;
    border-radius: 8px;
  }
  .income { background: #c6f6d5; }
  .expense { background: #fed7d7; }
  .savings { background: #faf089; }
  canvas {
    margin-top: 2rem;
  }
</style>
</head>

<body>
  <header>
    <h1>Qureshi Finance Report</h1>
  </header>

<main>
  <h2>Add Transaction</h2>

  <form id="transaction-form">
    <input id="desc" type="text" placeholder="Description" required />
    <input id="amount" type="number" placeholder="Amount" required />
    <select id="type" required>
      <option value="income">Income</option>
      <option value="expense">Expense</option>
    </select>
    <input id="date" type="date" required />
    <button type="submit">Add</button>
  </form>

  <!-- ✅ Button to download Excel -->
  <button id="exportExcel">Export to Excel</button>

  <table id="transactions">
    <thead>
      <tr>
        <th>Description</th>
        <th>Type</th>
        <th>Amount</th>
        <th>Month</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <div class="summary">
    <div class="income"><h3>Income</h3><p id="total-income">$0.00</p></div>
    <div class="expense"><h3>Expenses</h3><p id="total-expense">$0.00</p></div>
    <div class="savings"><h3>Savings</h3><p id="total-savings">$0.00</p></div>
  </div>

  <canvas id="pieChart"></canvas>
  <canvas id="barChart"></canvas>
</main>

<script>
const form = document.getElementById('transaction-form');
const tbody = document.querySelector('#transactions tbody');
const totalIncomeEl = document.getElementById('total-income');
const totalExpenseEl = document.getElementById('total-expense');
const totalSavingsEl = document.getElementById('total-savings');
const pieCtx = document.getElementById('pieChart').getContext('2d');
const barCtx = document.getElementById('barChart').getContext('2d');
let transactions = JSON.parse(localStorage.getItem('transactions')) || [];

function render() {
  tbody.innerHTML = '';
  let income = 0, expense = 0;
  const monthly = {};

  transactions.forEach((t, i) => {
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td>${t.desc}</td>
      <td>${t.type}</td>
      <td>$${t.amount.toFixed(2)}</td>
      <td>${t.date || '-'}</td>
      <td><button onclick="deleteTransaction(${i})">❌</button></td>
    `;
    tbody.appendChild(tr);

    if (t.type === 'income') income += t.amount;
    else expense += t.amount;

    if (!monthly[t.date]) monthly[t.date] = { income: 0, expense: 0 };
    monthly[t.date][t.type] += t.amount;
  });

  totalIncomeEl.textContent = `$${income.toFixed(2)}`;
  totalExpenseEl.textContent = `$${expense.toFixed(2)}`;
  totalSavingsEl.textContent = `$${(income - expense).toFixed(2)}`;

  localStorage.setItem('transactions', JSON.stringify(transactions));

  // Charts
  if (window.pieChart) window.pieChart.destroy();
  window.pieChart = new Chart(pieCtx, {
    type: 'pie',
    data: {
      labels: ['Income', 'Expense'],
      datasets: [{
        data: [income, expense],
        backgroundColor: ['#48bb78', '#f56565']
      }]
    }
  });

  if (window.barChart) window.barChart.destroy();
  const months = Object.keys(monthly);
  const incData = months.map(m => monthly[m].income);
  const expData = months.map(m => monthly[m].expense);
  window.barChart = new Chart(barCtx, {
    type: 'bar',
    data: {
      labels: months,
      datasets: [
        { label: 'Income', data: incData, backgroundColor: '#68d391' },
        { label: 'Expense', data: expData, backgroundColor: '#fc8181' }
      ]
    }
  });
}

form.addEventListener('submit', e => {
  e.preventDefault();
  const desc = document.getElementById('desc').value.trim();
  const amount = parseFloat(document.getElementById('amount').value);
  const type = document.getElementById('type').value;
  const date = document.getElementById('date').value || new Date().toISOString().slice(0,7);
  transactions.push({ desc, amount, type, date });
  form.reset();
  render();
});

function deleteTransaction(i) {
  transactions.splice(i, 1);
  render();
}

// ✅ EXPORT TO EXCEL FUNCTION
document.getElementById('exportExcel').addEventListener('click', () => {
  if (transactions.length === 0) {
    alert("No transactions to export!");
    return;
  }

  // Convert to Excel worksheet
  const ws = XLSX.utils.json_to_sheet(transactions);
  const wb = XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(wb, ws, "Transactions");

  // Trigger download
  XLSX.writeFile(wb, "Qureshi_Finance_Report.xlsx");
});

// Service Worker (optional PWA feature)
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('service-worker.js');
}

render();
</script>
</body>
</html>


